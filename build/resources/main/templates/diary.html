<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns="http://www.w3.org/1999/html"
      layout:decorate="~{layouts/layout}">

<th:block layout:fragment="script">
    <script th:inline="javascript">
        $(document).ready(function() {
            $('#boardPlus').click(function() {
                var board = $('#boardInput').val().trim();
                if (board && board.length > 0 && board.length <= 20) {
                    $.ajax({
                        url: 'api/addBoard',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({ boardName: board }),
                        success: function(response) {
                            //여기에 일기장을 보여주자
                        },
                        error: function(xhr, status, error) {
                            if (xhr.responseText) {
                                var errorMessage = JSON.parse(xhr.responseText).message;
                                alert(errorMessage);
                            } else {
                                alert("일기장 추가 실패함..");
                            }
                        }
                    });
                }
            });
            $('#boardMinus').click(function() {
                var board = $('#boardInput').val().trim();
                if(board && board.length > 0 && board.length <= 20) {
                    $.ajax({
                        url: 'api/deleteBoard',
                        type: 'DELETE',
                        contentType: 'application/json',
                        data: JSON.stringify({ boardName: board }),
                        success: function(response) {
                            alert("일기장 삭제 성공");
                        },
                        error: function(xhr, status, error) {
                            if(xhr.responseText) {
                                var errorMessage = JSON.parse(xhr.responseText).message;
                                alert(errorMessage);
                            } else {
                                alert("일기장 삭제 실패..");
                            }
                        }
                    });
                }
            });
            function loadBoard() {
                $.ajax({
                    url: 'api/getBoard',
                    type: 'GET',
                    success: function(response) {
                        response.forEach(function(board) {
                            createBoard(board.title);
                        });
                    },
                    error: function(xhr, status, error) {
                        console.error("일기 로드 실패", error);
                    }
                });
            }
            function createBoard(title) {
                var diary = $('<div>')
                    .addClass('card')
                    .css({
                        'position': 'relative',
                        'flex': '0 0 30%',
                        'margin': '1%'
                    })
                    .append(
                        $('<div>').addClass('card-body').text(title)
                    );

                $('#diary-container').append(diary);
            }
            loadBoard();
        });

    </script>
</th:block>

<div layout:fragment="content">
    <div class="row justify-content-center">
        <div class="col-md-5">
            <div class="card">
                <div class="card-body">
                    <p class="text-center">일기장 추가</p>
                    <hr>
                    <form id="diaryForm">
                        <div class="mb-3 text-center">
                            <input type="text" class="form-control" id="boardInput" placeholder="일기장 제목" style="flex-grow: 1;" maxlength="20">
                        </div>
                        <div class="mb-3 text-center">
                            <button id="boardPlus" class="btn btn-dark opacity-75">추가하기</button>
                            <button id="boardMinus" class="btn btn-dark opacity-75">삭제하기</button>
                        </div>
                        <div id="diary-container"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
